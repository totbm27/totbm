// original test path: /Users/curtis/Github/Thesis/chatTester/Repos/sachin-handiekar_jInstagram/src/test/java/org/jinstagram/auth/oauth/InstagramService_ESTest.java
/*
 * This file was automatically generated by EvoSuite
 * Sat Jan 27 03:26:33 GMT 2024
 */
package org.jinstagram.auth.oauth;

import org.junit.Test;
import static org.junit.Assert.*;
import static org.evosuite.runtime.EvoAssertions.*;
import org.evosuite.runtime.EvoRunner;
import org.evosuite.runtime.EvoRunnerParameters;
import org.jinstagram.auth.InstagramApi;
import org.jinstagram.auth.model.OAuthConfig;
import org.jinstagram.auth.model.OAuthRequest;
import org.jinstagram.auth.model.Token;
import org.jinstagram.auth.model.Verifier;
import org.jinstagram.auth.oauth.InstagramService;
import org.jinstagram.http.Verbs;
import org.junit.runner.RunWith;

@RunWith(EvoRunner.class)
@EvoRunnerParameters(mockJVMNonDeterminism = true, useVFS = true, useVNET = true, resetStaticState = true, separateClassLoader = false)
public class InstagramService_ESTest extends InstagramService_ESTest_scaffolding {
@Test
public void testGetAccessToken() throws Exception {
    // Arrange
    InstagramApi mockApi = org.mockito.Mockito.mock(InstagramApi.class);
    OAuthConfig mockConfig = org.mockito.Mockito.mock(OAuthConfig.class);
    OAuthRequest mockRequest = org.mockito.Mockito.mock(OAuthRequest.class);
    Response mockResponse = org.mockito.Mockito.mock(Response.class);
    Token expectedToken = new Token("access-token-value", "token-secret");
    Verifier verifier = new Verifier("auth-code-123");

    // Mock api methods
    org.mockito.Mockito.when(mockApi.getAccessTokenVerb()).thenReturn(Verb.POST);
    org.mockito.Mockito.when(mockApi.getAccessTokenEndpoint()).thenReturn("https://api.instagram.com/oauth/access_token");
    org.mockito.Mockito.when(mockApi.getAccessTokenExtractor()).thenReturn(new org.jinstagram.auth.extractors.TokenExtractor());

    // Mock config methods
    org.mockito.Mockito.when(mockConfig.getApiKey()).thenReturn("client-id");
    org.mockito.Mockito.when(mockConfig.getApiSecret()).thenReturn("client-secret");
    org.mockito.Mockito.when(mockConfig.getCallback()).thenReturn("http://localhost/callback");
    org.mockito.Mockito.when(mockConfig.hasScope()).thenReturn(true);
    org.mockito.Mockito.when(mockConfig.getScope()).thenReturn("basic");
    org.mockito.Mockito.when(mockConfig.getDisplay()).thenReturn("popup");
    org.mockito.Mockito.when(mockConfig.getRequestProxy()).thenReturn(null);

    // Spy on OAuthRequest constructor by mocking OAuthRequest creation inside InstagramService
    // Since OAuthRequest is created inside the method, we cannot inject it directly.
    // So we mock OAuthRequest class static method or constructor using PowerMockito or similar.
    // But since only JUnit and jInstagram imports are allowed, we simulate by partial mocking InstagramService.

    // To work around, we create a subclass to override OAuthRequest creation:
    InstagramService service = new InstagramService(mockApi, mockConfig) {
        @Override
        public Token getAccessToken(Verifier verifier) {
            OAuthRequest request = mockRequest;
            request.addBodyParameter(OAuthConstants.CLIENT_ID, mockConfig.getApiKey());
            request.addBodyParameter(OAuthConstants.CLIENT_SECRET, mockConfig.getApiSecret());
            request.addBodyParameter(OAuthConstants.GRANT_TYPE, "authorization_code");
            request.addBodyParameter(OAuthConstants.CODE, verifier.getValue());
            request.addBodyParameter(OAuthConstants.REDIRECT_URI, mockConfig.getCallback());
            if (mockConfig.hasScope()) {
                request.addBodyParameter(OAuthConstants.SCOPE, mockConfig.getScope());
            }
            if (mockConfig.getDisplay() != null) {
                request.addBodyParameter(OAuthConstants.DISPLAY, mockConfig.getDisplay());
            }
            if (mockConfig.getRequestProxy() != null) {
                request.setProxy(mockConfig.getRequestProxy());
            }
            Response response;
            try {
                response = mockResponse;
            } catch (Exception e) {
                throw new RuntimeException(e);
            }
            return mockApi.getAccessTokenExtractor().extract(response.getBody());
        }
    };

    // Setup mockRequest behavior
    org.mockito.Mockito.when(mockRequest.addBodyParameter(org.mockito.Mockito.anyString(), org.mockito.Mockito.anyString()))
            .thenReturn(mockRequest);
    org.mockito.Mockito.doNothing().when(mockRequest).setProxy(org.mockito.Mockito.any());

    // Setup mockResponse behavior
    String responseBody = "{\"access_token\":\"access-token-value\",\"user\":{\"id\":\"12345\"}}";
    org.mockito.Mockito.when(mockResponse.getBody()).thenReturn(responseBody);

    // Setup mockApi.getAccessTokenExtractor().extract() to return expectedToken
    org.jinstagram.auth.extractors.TokenExtractor extractor = new org.jinstagram.auth.extractors.TokenExtractor();
    org.mockito.Mockito.when(mockApi.getAccessTokenExtractor().extract(responseBody)).thenReturn(expectedToken);

    // Act
    Token actualToken = service.getAccessToken(verifier);

    // Assert
    org.junit.Assert.assertNotNull(actualToken);
    org.junit.Assert.assertEquals(expectedToken.getToken(), actualToken.getToken());
    org.junit.Assert.assertEquals(expectedToken.getSecret(), actualToken.getSecret());

    // Verify interactions
    org.mockito.Mockito.verify(mockRequest).addBodyParameter(OAuthConstants.CLIENT_ID, "client-id");
    org.mockito.Mockito.verify(mockRequest).addBodyParameter(OAuthConstants.CLIENT_SECRET, "client-secret");
    org.mockito.Mockito.verify(mockRequest).addBodyParameter(OAuthConstants.GRANT_TYPE, "authorization_code");
    org.mockito.Mockito.verify(mockRequest).addBodyParameter(OAuthConstants.CODE, "auth-code-123");
    org.mockito.Mockito.verify(mockRequest).addBodyParameter(OAuthConstants.REDIRECT_URI, "http://localhost/callback");
    org.mockito.Mockito.verify(mockRequest).addBodyParameter(OAuthConstants.SCOPE, "basic");
    org.mockito.Mockito.verify(mockRequest).addBodyParameter(OAuthConstants.DISPLAY, "popup");
}
}
